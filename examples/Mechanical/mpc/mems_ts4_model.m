function model = mems_ts4_model(p, plot_geom)

if nargin == 0
    p = zeros(8,1);
    plot_geom = true;
elseif nargin == 1
    plot_geom = true;
end

if length(p)~=8
    error('p must contain the lenghts of the 8 beams')
end

% Rigid body shapes
% sense mass
xy{1} = [-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-90.90	-90.90	-87.90	-87.90	-77.10	-77.10	-74.10	-74.10	-99.40	-99.40	-90.90	-90.90	-87.90	-87.90	-77.10	-77.10	-74.10	-74.10	-99.40	-99.40	-90.90	-90.90	-87.90	-87.90	-77.10	-77.10	-74.10	-74.10	-99.40	-99.40	-103.60	-104.10	-104.60	-105.00	-105.30	-105.50	-105.60	-105.60	-109.80	-109.80	-90.90	-90.90	-87.90	-87.90	-77.10	-77.10	-74.10	-74.10	-109.80	-109.80	-90.90	-90.90	-87.90	-87.90	-77.10	-77.10	-74.10	-74.10	-109.80	-109.80	-105.60	-105.60	-105.50	-105.30	-105.00	-104.60	-104.10	-103.60	-99.40	-99.40	-90.90	-90.90	-87.90	-87.90	-77.10	-77.10	-74.10	-74.10	-99.40	-99.40	-90.90	-90.90	-87.90	-87.90	-77.10	-77.10	-74.10	-74.10	-99.40	-99.40	-90.90	-90.90	-87.90	-87.90	-77.10	-77.10	-74.10	-74.10	-99.40	-99.40	-65.60	-65.60	-48.20	-48.20	-43.40	-43.40	-18.20	-18.20	-13.40	-13.40	11.80	11.80	16.60	16.60	41.80	41.80	46.60	46.60	71.80	71.80	76.60	76.60	101.80	101.80	106.60	106.60	131.80	131.80	136.60	136.60	161.80	161.80	166.60	166.60	191.80	191.80	196.60	196.60	221.80	221.80	226.60	226.60	244.00	244.00	252.50	252.50	255.50	255.50	266.30	266.30	269.30	269.30	244.00	244.00	252.50	252.50	255.50	255.50	266.30	266.30	269.30	269.30	244.00	244.00	252.50	252.50	255.50	255.50	266.30	266.30	269.30	269.30	244.00	244.00	252.50	252.50	255.50	255.50	266.30	266.30	269.30	269.30	244.00	244.00	252.50	252.50	255.50	255.50	266.30	266.30	269.30	269.30	244.00	244.00	252.50	252.50	255.50	255.50	266.30	266.30	269.30	269.30	244.00	244.00	252.50	252.50	255.50	255.50	266.30	266.30	269.30	269.30	244.00	244.00	252.50	252.50	255.50	255.50	266.30	266.30	269.30	269.30	244.00	244.00	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	-88.30	-88.30	-85.30	-85.30	-72.30	-72.30	-69.30	-69.30	-56.30	-56.30	-53.30	-53.30	-40.30	-40.30	-37.30	-37.30	-24.30	-24.30	-21.30	-21.30	-8.30	-8.30	-5.30	-5.30	7.70	7.70	10.70	10.70	23.70	23.70	26.70	26.70	39.70	39.70	42.70	42.70	55.70	55.70	58.70	58.70	71.70	71.70	74.70	74.70	87.70	87.70	90.70	90.70	103.70	103.70	106.70	106.70	119.70	119.70	122.70	122.70	135.70	135.70	138.70	138.70	151.70	151.70	154.70	154.70	167.70	167.70	170.70	170.70	183.70	183.70	186.70	186.70	199.70	199.70	202.70	202.70	215.70	215.70	218.70	218.70	231.70	231.70	234.70	234.70	247.70	247.70	250.70	250.70	263.70	263.70	266.70	266.70	-99.40	-99.40	277.80	277.80	282.00	282.50	283.00	283.40	283.70	283.90	284.00	284.00	288.20	288.20	284.00	284.00	283.90	283.70	283.40	283.00	282.50	282.00	277.80	277.80
         279.10	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	290.80	290.80	293.80	293.80	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	305.30	305.30	308.30	308.30	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	319.80	319.80	322.80	322.80	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	334.30	334.30	337.30	337.30	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	348.80	348.80	351.80	351.80	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	363.30	363.30	366.30	366.30	384.50	384.50	381.50	381.50	384.50	384.50	381.50	381.50	384.50	384.50	399.00	399.00	396.00	396.00	399.00	399.00	396.00	396.00	399.00	399.00	413.50	413.50	410.50	410.50	413.50	413.50	410.50	410.50	413.50	413.50	421.10	421.10	421.00	420.80	420.50	420.10	419.60	419.10	417.10	417.10	428.00	428.00	425.00	425.00	428.00	428.00	425.00	425.00	428.00	428.00	442.00	442.00	439.00	439.00	442.00	442.00	439.00	439.00	442.00	442.00	449.90	449.90	447.90	447.40	446.90	446.50	446.20	446.00	445.90	445.90	456.50	456.50	453.50	453.50	456.50	456.50	453.50	453.50	456.50	456.50	471.00	471.00	468.00	468.00	471.00	471.00	468.00	468.00	471.00	471.00	485.50	485.50	482.50	482.50	485.50	485.50	482.50	482.50	485.50	485.50	489.10	489.10	377.90	377.90	489.10	489.10	377.90	377.90	489.10	489.10	377.90	377.90	489.10	489.10	377.90	377.90	489.10	489.10	377.90	377.90	489.10	489.10	377.90	377.90	489.10	489.10	377.90	377.90	489.10	489.10	377.90	377.90	489.10	489.10	377.90	377.90	489.10	489.10	377.90	377.90	489.10	489.10	377.90	377.90	384.50	384.50	381.50	381.50	384.50	384.50	381.50	381.50	384.50	384.50	399.00	399.00	396.00	396.00	399.00	399.00	396.00	396.00	399.00	399.00	413.50	413.50	410.50	410.50	413.50	413.50	410.50	410.50	413.50	413.50	428.00	428.00	425.00	425.00	428.00	428.00	425.00	425.00	428.00	428.00	442.00	442.00	439.00	439.00	442.00	442.00	439.00	439.00	442.00	442.00	456.50	456.50	453.50	453.50	456.50	456.50	453.50	453.50	456.50	456.50	471.00	471.00	468.00	468.00	471.00	471.00	468.00	468.00	471.00	471.00	485.50	485.50	482.50	482.50	485.50	485.50	482.50	482.50	485.50	485.50	489.10	489.10	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	500.70	500.70	503.70	503.70	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	515.20	515.20	518.20	518.20	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	529.70	529.70	532.70	532.70	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	544.20	544.20	547.20	547.20	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	558.70	558.70	561.70	561.70	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	573.20	573.20	576.20	576.20	587.90	587.90	445.90	445.90	446.00	446.20	446.50	446.90	447.40	447.90	449.90	449.90	417.10	417.10	419.10	419.60	420.10	420.50	420.80	421.00	421.10	421.10	279.10]';

% drive frame
xy{2} = [-141.2	-141.2	-126.4	-126.4	-124.8	-124.8	-120.2	-120.2	-117.8	-117.8	-113.2	-113.2	-110.8	-110.8	-106.2	-106.2	-103.8	-103.8	-99.2	-99.2	-96.8	-96.8	-92.2	-92.2	-89.8	-89.8	-85.2	-85.2	-82.8	-82.8	-78.2	-78.2	-75.8	-75.8	-71.2	-71.2	-68.8	-68.8	-64.2	-64.2	-61.8	-61.8	-57.2	-57.2	-54.8	-54.8	-50.2	-50.2	-47.8	-47.8	-43.2	-43.2	-40.8	-40.8	-36.2	-36.2	-33.8	-33.8	-29.2	-29.2	-26.8	-26.8	-22.2	-22.2	-19.8	-19.8	-15.2	-15.2	-12.8	-12.8	-8.2	-8.2	-5.8	-5.8	-1.2	-1.2	0.4	0.4	167.4	167.4	165	165	160.4	160.4	158	158	153.4	153.4	151	151	146.4	146.4	144	144	139.4	139.4	137	137	132.4	132.4	130	130	125.4	125.4	123	123	118.4	118.4	116	116	111.4	111.4	109	109	104.4	104.4	102	102	97.4	97.4	95	95	90.4	90.4	88	88	83.4	83.4	81	81	76.4	76.4	74	74	69.4	69.4	67	67	62.4	62.4	60	60	55.4	55.4	53	53	48.4	48.4	46	46	41.4	41.4	39	39	34.4	34.4	32	32	27.4	27.4	25	25	20.4	20.4	18	18	13.4	13.4	11	11	6.4	6.4	4.8	4.8	173.6	173.6	172	172	178	178	179.6	179.6	184.2	184.2	186.6	186.6	191.2	191.2	193.6	193.6	198.2	198.2	200.6	200.6	205.2	205.2	207.6	207.6	212.2	212.2	214.6	214.6	219.2	219.2	221.6	221.6	226.2	226.2	228.6	228.6	233.2	233.2	235.6	235.6	240.2	240.2	242.6	242.6	247.2	247.2	249.6	249.6	254.2	254.2	256.6	256.6	261.2	261.2	263.6	263.6	268.2	268.2	270.6	270.6	275.2	275.2	277.6	277.6	282.2	282.2	284.6	284.6	289.2	289.2	291.6	291.6	296.2	296.2	298.6	298.6	303.2	303.2	304.8	304.8	-141.2	-141.2	-127.9	-127.9	-124.9	-124.9	-141.2	-141.2	-126.4	-126.4	-126.3	-126.1	-125.8	-125.4	-124.9	-124.4	-122.4	-122.4	-124.4	-124.9	-125.4	-125.8	-126.1	-126.3	-126.4	-126.4	-122.2	-121.7	-121.2	-120.8	-120.5	-120.3	-120.2	-120.2	-116	-116	-120.2	-120.2	-120.3	-120.5	-120.8	-121.2	-121.7	-122.2	-126.4	-126.4	-126.3	-126.1	-125.8	-125.4	-124.9	-124.4	-122.4	-122.4	-124.4	-124.9	-125.4	-125.8	-126.1	-126.3	-126.4	-126.4	304.8	304.8	304.7	304.5	304.2	303.8	303.3	302.8	300.8	300.8	302.8	303.3	303.8	304.2	304.5	304.7	304.8	304.8	300.6	300.1	299.6	299.2	298.9	298.7	298.6	298.6	294.4	294.4	303.3	303.3	306.3	306.3	294.4	294.4	298.6	298.6	298.7	298.9	299.2	299.6	300.1	300.6	304.8	304.8	304.7	304.5	304.2	303.8	303.3	302.8	300.8	300.8	302.8	303.3	303.8	304.2	304.5	304.7	304.8	304.8	-141.2	-141.2	-126.4	-126.4	-124.8	-124.8	-120.2	-120.2	-117.8	-117.8	-113.2	-113.2	-110.8	-110.8	-106.2	-106.2	-103.8	-103.8	-99.2	-99.2	-96.8	-96.8	-92.2	-92.2	-89.8	-89.8	-85.2	-85.2	-82.8	-82.8	-78.2	-78.2	-75.8	-75.8	-71.2	-71.2	-68.8	-68.8	-64.2	-64.2	-61.8	-61.8	-57.2	-57.2	-54.8	-54.8	-50.2	-50.2	-47.8	-47.8	-43.2	-43.2	-40.8	-40.8	-36.2	-36.2	-33.8	-33.8	-29.2	-29.2	-26.8	-26.8	-22.2	-22.2	-19.8	-19.8	-15.2	-15.2	-12.8	-12.8	-8.2	-8.2	-5.8	-5.8	-1.2	-1.2	0.4	0.4	167.4	167.4	165	165	160.4	160.4	158	158	153.4	153.4	151	151	146.4	146.4	144	144	139.4	139.4	137	137	132.4	132.4	130	130	125.4	125.4	123	123	118.4	118.4	116	116	111.4	111.4	109	109	104.4	104.4	102	102	97.4	97.4	95	95	90.4	90.4	88	88	83.4	83.4	81	81	76.4	76.4	74	74	69.4	69.4	67	67	62.4	62.4	60	60	55.4	55.4	53	53	48.4	48.4	46	46	41.4	41.4	39	39	34.4	34.4	32	32	27.4	27.4	25	25	20.4	20.4	18	18	13.4	13.4	11	11	6.4	6.4	4.8	4.8	173.6	173.6	172	172	178	178	179.6	179.6	184.2	184.2	186.6	186.6	191.2	191.2	193.6	193.6	198.2	198.2	200.6	200.6	205.2	205.2	207.6	207.6	212.2	212.2	214.6	214.6	219.2	219.2	221.6	221.6	226.2	226.2	228.6	228.6	233.2	233.2	235.6	235.6	240.2	240.2	242.6	242.6	247.2	247.2	249.6	249.6	254.2	254.2	256.6	256.6	261.2	261.2	263.6	263.6	268.2	268.2	270.6	270.6	275.2	275.2	277.6	277.6	282.2	282.2	284.6	284.6	289.2	289.2	291.6	291.6	296.2	296.2	298.6	298.6	303.2	303.2	304.8	304.8	-141.2	-141.2	319.6	319.6
          153.1	237.1	237.1	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	237.1	237.1	213.1	213.1	167.9	167.9	213.1	213.1	237.1	237.1	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	167.9	167.9	191.9	191.9	237.1	237.1	435	435	432	432	435	435	615.1	615.1	605.9	605.4	604.9	604.5	604.2	604	603.9	603.9	599.1	599.1	599	598.8	598.5	598.1	597.6	597.1	445.9	445.9	446	446.2	446.5	446.9	447.4	447.9	449.9	449.9	417.1	417.1	419.1	419.6	420.1	420.5	420.8	421	421.1	421.1	269.9	269.4	268.9	268.5	268.2	268	267.9	267.9	263.1	263.1	263	262.8	262.5	262.1	261.6	261.1	251.9	251.9	261.1	261.6	262.1	262.5	262.8	263	263.1	263.1	267.9	267.9	268	268.2	268.5	268.9	269.4	269.9	421.1	421.1	421	420.8	420.5	420.1	419.6	419.1	417.1	417.1	435	435	432	432	435	435	449.9	449.9	447.9	447.4	446.9	446.5	446.2	446	445.9	445.9	597.1	597.6	598.1	598.5	598.8	599	599.1	599.1	603.9	603.9	604	604.2	604.5	604.9	605.4	605.9	615.1	615.1	699.1	699.1	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	699.1	699.1	675.1	675.1	629.9	629.9	675.1	675.1	699.1	699.1	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	629.9	629.9	653.9	653.9	699.1	699.1	713.9	713.9	153.1]';

xm = min(xy{2}(:,1));
xM = max(xy{2}(:,1));
ym = min(xy{2}(:,2));
yM = max(xy{2}(:,2));
offset = [mean([xm xM]) mean([ym yM])];
xy{1} = xy{1} - offset;
xy{2} = xy{2} - offset;

% geometric properties
xg  = zeros(length(xy),1);
yg  = zeros(length(xy),1);
A   = zeros(length(xy),1);
Ixx = zeros(length(xy),1);
Iyy = zeros(length(xy),1);
for ii = 1 : length(xy)
    [xg(ii), yg(ii), A(ii), Ixx(ii), Iyy(ii)] = area_properties(xy{ii}(:,1), xy{ii}(:,2));
end

% create joints (start and end coordinates of each beam)
L0 = 165;
L1 = L0 + p(1);
joints{1} = [-211.6    168
             -211.6+L1 168];

L2 = L0 + p(2);
joints{2} = [211.6-L2 168
             211.6    168];

L3 = L0 + p(3);
joints{3} = [-211.6    -168
             -211.6+L3 -168];

L4 = L0 + p(4);
joints{4} = [211.6-L4 -168
             211.6    -168];

L0b = 120;
L5 = L0b + p(5);
joints{5} = [-207.3 16.4
             -207.3 16.4+L5
             -196.9 16.4+L5
             -196.9 16.4];

L6 = L0b + p(6);
joints{6} = [207.3 16.4
             207.3 16.4+L6
             196.9 16.4+L6
             196.9 16.4];

L7 = L0b + p(7);
joints{7} = [207.3 -16.4
             207.3 -16.4-L7
             196.9 -16.4-L7
             196.9 -16.4];

L8 = L0b + p(8);
joints{8} = [-207.3 -16.4
             -207.3 -16.4-L8
             -196.9 -16.4-L8
             -196.9 -16.4];

% add a column to define the mass the joints are attached to or to specify
% if the joint is clamped (-1). If an internal joint (e.g. as in a folded
% beam), put 0.
joints{1}(:,3) = [2 -1];
joints{2}(:,3) = [-1 2];
joints{3}(:,3) = [2 -1];
joints{4}(:,3) = [-1 2];
joints{5}(:,3) = [2 0 0 1];
joints{6}(:,3) = [2 0 0 1];
joints{7}(:,3) = [2 0 0 1];
joints{8}(:,3) = [2 0 0 1];

% specify the constrained DOFs for each mass (1=fixed, 0=free)
mass_constraints = [...
    0 0 0       % 1: sense mass
    0 0 0];     % 2: drive frame

model.joints = joints;
model.xg  = xg;
model.yg  = yg;
model.mass_constraints = mass_constraints;
model.xy  = xy;
model.A   = A;
model.Ixx = Ixx;
model.Iyy = Iyy;

% PLOT GEOMETRY
if plot_geom == 1
    figure
    hold on
    % plot mass shapes
    for ii = 1 : length(xy)
        patch(xy{ii}(:,1),   xy{ii}(:,2),  'k','EdgeColor','none')
    end
    % plot joints and tags
    for ii = 1 : length(joints)
        plot(joints{ii}(:,1), joints{ii}(:,2),'r','LineWidth',2)
        text(mean(joints{ii}(:,1)), mean(joints{ii}(:,2)), num2str(ii),'HorizontalAlignment','center')
        % plot mass-joint (master-slave) connection lines
        for jj = 1 : size(joints{ii},1)
            nm = joints{ii}(jj,3);  % mass number
            if nm==0 % internal joint
                continue
            end
            xs = joints{ii}(jj,1);  % x slave
            ys = joints{ii}(jj,2);  % y slave
            if nm==-1 % clamped joint
                plot(xs, ys, 'ks', 'MarkerFaceColor','k',MarkerSize=7)
                continue
            end
            xm = xg(nm);            % x master
            ym = yg(nm);            % y master
            plot([xs xm],[ys ym],'--','LineWidth',1)
        end
    end
    
    % plot mass tags
    for ii = 1 : length(xy)
        hold on
        plot(xg(ii), yg(ii), 'ko', 'MarkerFaceColor','y',MarkerSize=10)
        text(xg(ii), yg(ii), num2str(ii),'HorizontalAlignment','center')
    end
    axis equal
    axis off
end

