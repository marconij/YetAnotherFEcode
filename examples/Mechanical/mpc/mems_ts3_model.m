function model = mems_ts3_model(p, plot_geom)

if nargin == 0
    p = zeros(4,1);
    plot_geom = true;
elseif nargin == 1
    plot_geom = true;
end

if length(p)~=4
    error('p must contain the lenghts of the 4 beams')
end

% Rigid body shapes
% top-left folded-beam
xy{1} = [-994.00000	627.40000
    -1008.80000	627.40000
    -1008.80000	653.70000
    -994.00000	653.70000];
xy{2} = [-1100.00000	648.50000
    -1114.80000	648.50000
    -1114.80000	674.80000
    -1100.00000	674.80000];
xy{3} = [-994.00000	669.60000
    -1008.80000	669.60000
    -1008.80000	695.90000
    -994.00000	695.90000];
xy{4} = [-1100.00000	690.70000
    -1114.80000	690.70000
    -1114.80000	717.00000
    -1100.00000	717.00000];

% top-right folded-beam
xy{5} = [-774.80000	627.40000
    -760.00000	627.40000
    -760.00000	653.70000
    -774.80000	653.70000];
xy{6} = [-668.80000	648.50000
    -654.00000	648.50000
    -654.00000	674.80000
    -668.80000	674.80000];
xy{7} = [-774.80000	669.60000
    -760.00000	669.60000
    -760.00000	695.90000
    -774.80000	695.90000];
xy{8} = [-668.80000	690.70000
    -654.00000	690.70000
    -654.00000	717.00000
    -668.80000	717.00000];

% bottom-left folded-beam
xy{9} = [-774.80000	234.80000
    -760.00000	234.80000
    -760.00000	208.50000
    -774.80000	208.50000];
xy{10} = [-668.80000	213.70000
    -654.00000	213.70000
    -654.00000	187.40000
    -668.80000	187.40000];
xy{11} = [-774.80000	192.60000
    -760.00000	192.60000
    -760.00000	166.30000
    -774.80000	166.30000];
xy{12} = [-668.80000	171.50000
    -654.00000	171.50000
    -654.00000	145.20000
    -668.80000	145.20000];
% bottom-right folded-beam
xy{13} = [-994.00000	234.80000
    -1008.80000	234.80000
    -1008.80000	208.50000
    -994.00000	208.50000];
xy{14} = [-1100.00000	213.70000
    -1114.80000	213.70000
    -1114.80000	187.40000
    -1100.00000	187.40000];
xy{15} = [-994.00000	192.60000
    -1008.80000	192.60000
    -1008.80000	166.30000
    -994.00000	166.30000];
xy{16} = [-1100.00000	171.50000
    -1114.80000	171.50000
    -1114.80000	145.20000
    -1100.00000	145.20000];

% central mass
xy{17} = [-964.8	-964.8	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-964.8	-964.8	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-964.8	-964.8	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-964.8	-964.8	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-964.8	-964.8	-1100	-1100	-1114.8	-1114.8	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-1114.8	-1114.8	-1101.3	-1101.3	-1099.7	-1099.7	-1095.1	-1095.1	-1092.7	-1092.7	-1088.1	-1088.1	-1085.7	-1085.7	-1081.1	-1081.1	-1078.7	-1078.7	-1074.1	-1074.1	-1071.7	-1071.7	-1067.1	-1067.1	-1064.7	-1064.7	-1060.1	-1060.1	-1057.7	-1057.7	-1053.1	-1053.1	-1050.7	-1050.7	-1046.1	-1046.1	-1043.7	-1043.7	-1039.1	-1039.1	-1036.7	-1036.7	-1032.1	-1032.1	-1029.7	-1029.7	-1025.1	-1025.1	-1022.7	-1022.7	-1018.1	-1018.1	-1015.7	-1015.7	-1011.1	-1011.1	-1008.7	-1008.7	-1004.1	-1004.1	-1001.7	-1001.7	-997.1	-997.1	-994.7	-994.7	-990.1	-990.1	-987.7	-987.7	-983.1	-983.1	-980.7	-980.7	-976.1	-976.1	-973.7	-973.7	-969.1	-969.1	-966.7	-966.7	-962.1	-962.1	-959.7	-959.7	-955.1	-955.1	-952.7	-952.7	-948.1	-948.1	-945.7	-945.7	-941.1	-941.1	-938.7	-938.7	-934.1	-934.1	-931.7	-931.7	-927.1	-927.1	-924.7	-924.7	-920.1	-920.1	-917.7	-917.7	-913.1	-913.1	-910.7	-910.7	-906.1	-906.1	-903.7	-903.7	-899.1	-899.1	-896.7	-896.7	-892.1	-892.1	-890.5	-890.5	-878.3	-878.3	-876.7	-876.7	-872.1	-872.1	-869.7	-869.7	-865.1	-865.1	-862.7	-862.7	-858.1	-858.1	-855.7	-855.7	-851.1	-851.1	-848.7	-848.7	-844.1	-844.1	-841.7	-841.7	-837.1	-837.1	-834.7	-834.7	-830.1	-830.1	-827.7	-827.7	-823.1	-823.1	-820.7	-820.7	-816.1	-816.1	-813.7	-813.7	-809.1	-809.1	-806.7	-806.7	-802.1	-802.1	-799.7	-799.7	-795.1	-795.1	-792.7	-792.7	-788.1	-788.1	-785.7	-785.7	-781.1	-781.1	-778.7	-778.7	-774.1	-774.1	-771.7	-771.7	-767.1	-767.1	-764.7	-764.7	-760.1	-760.1	-757.7	-757.7	-753.1	-753.1	-750.7	-750.7	-746.1	-746.1	-743.7	-743.7	-739.1	-739.1	-736.7	-736.7	-732.1	-732.1	-729.7	-729.7	-725.1	-725.1	-722.7	-722.7	-718.1	-718.1	-715.7	-715.7	-711.1	-711.1	-708.7	-708.7	-704.1	-704.1	-701.7	-701.7	-697.1	-697.1	-694.7	-694.7	-690.1	-690.1	-687.7	-687.7	-683.1	-683.1	-680.7	-680.7	-676.1	-676.1	-673.7	-673.7	-669.1	-669.1	-667.5	-667.5	-1114.8	-1114.8	-1015.7	-1015.7	-1018.1	-1018.1	-1022.7	-1022.7	-1025.1	-1025.1	-1029.7	-1029.7	-1032.1	-1032.1	-1036.7	-1036.7	-1039.1	-1039.1	-1043.7	-1043.7	-1046.1	-1046.1	-1050.7	-1050.7	-1053.1	-1053.1	-1057.7	-1057.7	-1060.1	-1060.1	-1064.7	-1064.7	-1067.1	-1067.1	-1071.7	-1071.7	-1074.1	-1074.1	-1078.7	-1078.7	-1081.1	-1081.1	-1085.7	-1085.7	-1088.1	-1088.1	-1092.7	-1092.7	-1095.1	-1095.1	-1099.7	-1099.7	-1101.3	-1101.3	-1009.5	-1009.5	-1001.5	-1001.5	-998.5	-998.5	-983.7	-983.7	-980.7	-980.7	-965.9	-965.9	-962.9	-962.9	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-805.9	-805.9	-802.9	-802.9	-788.1	-788.1	-785.1	-785.1	-770.3	-770.3	-767.3	-767.3	-1009.5	-1009.5	-1001.5	-1001.5	-998.5	-998.5	-983.7	-983.7	-980.7	-980.7	-965.9	-965.9	-962.9	-962.9	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-805.9	-805.9	-802.9	-802.9	-788.1	-788.1	-785.1	-785.1	-770.3	-770.3	-767.3	-767.3	-1009.5	-1009.5	-1001.5	-1001.5	-998.5	-998.5	-983.7	-983.7	-980.7	-980.7	-965.9	-965.9	-962.9	-962.9	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-805.9	-805.9	-802.9	-802.9	-788.1	-788.1	-785.1	-785.1	-770.3	-770.3	-767.3	-767.3	-1009.5	-1009.5	-1011.1	-1011.1	-1001.5	-1001.5	-998.5	-998.5	-983.7	-983.7	-980.7	-980.7	-965.9	-965.9	-962.9	-962.9	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-805.9	-805.9	-802.9	-802.9	-788.1	-788.1	-785.1	-785.1	-770.3	-770.3	-767.3	-767.3	-1011.1	-1011.1	-673.7	-673.7	-676.1	-676.1	-680.7	-680.7	-683.1	-683.1	-687.7	-687.7	-690.1	-690.1	-694.7	-694.7	-697.1	-697.1	-701.7	-701.7	-704.1	-704.1	-708.7	-708.7	-711.1	-711.1	-715.7	-715.7	-718.1	-718.1	-722.7	-722.7	-725.1	-725.1	-729.7	-729.7	-732.1	-732.1	-736.7	-736.7	-739.1	-739.1	-743.7	-743.7	-746.1	-746.1	-750.7	-750.7	-753.1	-753.1	-757.7	-757.7	-759.3	-759.3	-667.5	-667.5	-669.1	-669.1	-1114.8	-1114.8	-1001.5	-1001.5	-998.5	-998.5	-983.7	-983.7	-980.7	-980.7	-965.9	-965.9	-962.9	-962.9	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-805.9	-805.9	-802.9	-802.9	-788.1	-788.1	-785.1	-785.1	-770.3	-770.3	-767.3	-767.3	-1114.8	-1114.8	-1108.3	-1108.3	-1105.3	-1105.3	-1090.5	-1090.5	-1087.5	-1087.5	-1072.7	-1072.7	-1069.7	-1069.7	-1054.9	-1054.9	-1051.9	-1051.9	-1037.1	-1037.1	-1034.1	-1034.1	-1019.3	-1019.3	-1016.3	-1016.3	-752.5	-752.5	-749.5	-749.5	-734.7	-734.7	-731.7	-731.7	-716.9	-716.9	-713.9	-713.9	-699.1	-699.1	-696.1	-696.1	-681.3	-681.3	-678.3	-678.3	-663.5	-663.5	-660.5	-660.5	-1114.8	-1114.8	-1001.5	-1001.5	-998.5	-998.5	-983.7	-983.7	-980.7	-980.7	-965.9	-965.9	-962.9	-962.9	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-805.9	-805.9	-802.9	-802.9	-788.1	-788.1	-785.1	-785.1	-770.3	-770.3	-767.3	-767.3	-1114.8	-1114.8	-1015.7	-1015.7	-1018.1	-1018.1	-1022.7	-1022.7	-1025.1	-1025.1	-1029.7	-1029.7	-1032.1	-1032.1	-1036.7	-1036.7	-1039.1	-1039.1	-1043.7	-1043.7	-1046.1	-1046.1	-1050.7	-1050.7	-1053.1	-1053.1	-1057.7	-1057.7	-1060.1	-1060.1	-1064.7	-1064.7	-1067.1	-1067.1	-1071.7	-1071.7	-1074.1	-1074.1	-1078.7	-1078.7	-1081.1	-1081.1	-1085.7	-1085.7	-1088.1	-1088.1	-1092.7	-1092.7	-1095.1	-1095.1	-1099.7	-1099.7	-1101.3	-1101.3	-1009.5	-1009.5	-1001.5	-1001.5	-998.5	-998.5	-983.7	-983.7	-980.7	-980.7	-965.9	-965.9	-962.9	-962.9	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-805.9	-805.9	-802.9	-802.9	-788.1	-788.1	-785.1	-785.1	-770.3	-770.3	-767.3	-767.3	-1009.5	-1009.5	-1001.5	-1001.5	-998.5	-998.5	-983.7	-983.7	-980.7	-980.7	-965.9	-965.9	-962.9	-962.9	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-805.9	-805.9	-802.9	-802.9	-788.1	-788.1	-785.1	-785.1	-770.3	-770.3	-767.3	-767.3	-1009.5	-1009.5	-1011.1	-1011.1	-1001.5	-1001.5	-998.5	-998.5	-983.7	-983.7	-980.7	-980.7	-965.9	-965.9	-962.9	-962.9	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-805.9	-805.9	-802.9	-802.9	-788.1	-788.1	-785.1	-785.1	-770.3	-770.3	-767.3	-767.3	-1011.1	-1011.1	-1001.5	-1001.5	-998.5	-998.5	-983.7	-983.7	-980.7	-980.7	-965.9	-965.9	-962.9	-962.9	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-805.9	-805.9	-802.9	-802.9	-788.1	-788.1	-785.1	-785.1	-770.3	-770.3	-767.3	-767.3	-1011.1	-1011.1	-673.7	-673.7	-676.1	-676.1	-680.7	-680.7	-683.1	-683.1	-687.7	-687.7	-690.1	-690.1	-694.7	-694.7	-697.1	-697.1	-701.7	-701.7	-704.1	-704.1	-708.7	-708.7	-711.1	-711.1	-715.7	-715.7	-718.1	-718.1	-722.7	-722.7	-725.1	-725.1	-729.7	-729.7	-732.1	-732.1	-736.7	-736.7	-739.1	-739.1	-743.7	-743.7	-746.1	-746.1	-750.7	-750.7	-753.1	-753.1	-757.7	-757.7	-759.3	-759.3	-667.5	-667.5	-669.1	-669.1	-1114.8	-1114.8	-1101.3	-1101.3	-1099.7	-1099.7	-1095.1	-1095.1	-1092.7	-1092.7	-1088.1	-1088.1	-1085.7	-1085.7	-1081.1	-1081.1	-1078.7	-1078.7	-1074.1	-1074.1	-1071.7	-1071.7	-1067.1	-1067.1	-1064.7	-1064.7	-1060.1	-1060.1	-1057.7	-1057.7	-1053.1	-1053.1	-1050.7	-1050.7	-1046.1	-1046.1	-1043.7	-1043.7	-1039.1	-1039.1	-1036.7	-1036.7	-1032.1	-1032.1	-1029.7	-1029.7	-1025.1	-1025.1	-1022.7	-1022.7	-1018.1	-1018.1	-1015.7	-1015.7	-1011.1	-1011.1	-1008.7	-1008.7	-1004.1	-1004.1	-1001.7	-1001.7	-997.1	-997.1	-994.7	-994.7	-990.1	-990.1	-987.7	-987.7	-983.1	-983.1	-980.7	-980.7	-976.1	-976.1	-973.7	-973.7	-969.1	-969.1	-966.7	-966.7	-962.1	-962.1	-959.7	-959.7	-955.1	-955.1	-952.7	-952.7	-948.1	-948.1	-945.7	-945.7	-941.1	-941.1	-938.7	-938.7	-934.1	-934.1	-931.7	-931.7	-927.1	-927.1	-924.7	-924.7	-920.1	-920.1	-917.7	-917.7	-913.1	-913.1	-910.7	-910.7	-906.1	-906.1	-903.7	-903.7	-899.1	-899.1	-896.7	-896.7	-892.1	-892.1	-890.5	-890.5	-878.3	-878.3	-876.7	-876.7	-872.1	-872.1	-869.7	-869.7	-865.1	-865.1	-862.7	-862.7	-858.1	-858.1	-855.7	-855.7	-851.1	-851.1	-848.7	-848.7	-844.1	-844.1	-841.7	-841.7	-837.1	-837.1	-834.7	-834.7	-830.1	-830.1	-827.7	-827.7	-823.1	-823.1	-820.7	-820.7	-816.1	-816.1	-813.7	-813.7	-809.1	-809.1	-806.7	-806.7	-802.1	-802.1	-799.7	-799.7	-795.1	-795.1	-792.7	-792.7	-788.1	-788.1	-785.7	-785.7	-781.1	-781.1	-778.7	-778.7	-774.1	-774.1	-771.7	-771.7	-767.1	-767.1	-764.7	-764.7	-760.1	-760.1	-757.7	-757.7	-753.1	-753.1	-750.7	-750.7	-746.1	-746.1	-743.7	-743.7	-739.1	-739.1	-736.7	-736.7	-732.1	-732.1	-729.7	-729.7	-725.1	-725.1	-722.7	-722.7	-718.1	-718.1	-715.7	-715.7	-711.1	-711.1	-708.7	-708.7	-704.1	-704.1	-701.7	-701.7	-697.1	-697.1	-694.7	-694.7	-690.1	-690.1	-687.7	-687.7	-683.1	-683.1	-680.7	-680.7	-676.1	-676.1	-673.7	-673.7	-669.1	-669.1	-667.5	-667.5	-1114.8	-1114.8	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-1114.8	-1114.8	-1100	-1100	-964.8	-964.8	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-964.8	-964.8	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-964.8	-964.8	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-964.8	-964.8	-948.1	-948.1	-945.1	-945.1	-930.3	-930.3	-927.3	-927.3	-912.5	-912.5	-909.5	-909.5	-894.7	-894.7	-891.7	-891.7	-877.1	-877.1	-874.1	-874.1	-859.3	-859.3	-856.3	-856.3	-841.5	-841.5	-838.5	-838.5	-823.7	-823.7	-820.7	-820.7	-964.8	-964.8	-913.5	-913.5	-855.3	-855.3	-804	-804	-668.8	-668.8	-654	-654	-668.8	-668.8	-804	-804
           170.7	184.3	184.3	181.3	181.3	184.3	184.3	181.3	181.3	184.3	184.3	181.3	181.3	184.3	184.3	181.3	181.3	184.3	184.3	181.3	181.3	184.3	184.3	181.3	181.3	184.3	184.3	181.3	181.3	184.3	184.3	181.3	181.3	184.3	184.3	202.1	202.1	199.1	199.1	202.1	202.1	199.1	199.1	202.1	202.1	199.1	199.1	202.1	202.1	199.1	199.1	202.1	202.1	199.1	199.1	202.1	202.1	199.1	199.1	202.1	202.1	199.1	199.1	202.1	202.1	199.1	199.1	202.1	202.1	219.9	219.9	216.9	216.9	219.9	219.9	216.9	216.9	219.9	219.9	216.9	216.9	219.9	219.9	216.9	216.9	219.9	219.9	216.9	216.9	219.9	219.9	216.9	216.9	219.9	219.9	216.9	216.9	219.9	219.9	216.9	216.9	219.9	219.9	237.7	237.7	234.7	234.7	237.7	237.7	234.7	234.7	237.7	237.7	234.7	234.7	237.7	237.7	234.7	234.7	237.7	237.7	234.7	234.7	237.7	237.7	234.7	234.7	237.7	237.7	234.7	234.7	237.7	237.7	234.7	234.7	237.7	237.7	250.7	250.7	229.6	229.6	255.5	255.5	252.5	252.5	255.5	255.5	252.5	252.5	255.5	255.5	252.5	252.5	255.5	255.5	252.5	252.5	255.5	255.5	252.5	252.5	255.5	255.5	252.5	252.5	255.5	255.5	252.5	252.5	255.5	255.5	252.5	252.5	255.5	255.5	334.2	334.2	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	334.2	334.2	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	265	265	289	289	334.2	334.2	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	348.5	348.5	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	349.6	349.6	352.6	352.6	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	367.4	367.4	370.4	370.4	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	385.2	385.2	388.2	388.2	393.7	393.7	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	403	403	406	406	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	417.7	417.7	393.7	393.7	348.5	348.5	393.7	393.7	417.7	417.7	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	420.8	420.8	423.8	423.8	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	429.6	429.6	432.6	432.6	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	438.4	438.4	441.4	441.4	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	444.5	444.5	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	456.2	456.2	459.2	459.2	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	474	474	477	477	489.7	489.7	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	491.8	491.8	494.8	494.8	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	509.6	509.6	512.6	512.6	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	513.7	513.7	489.7	489.7	444.5	444.5	489.7	489.7	513.7	513.7	597.2	597.2	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	597.2	597.2	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	528	528	552	552	597.2	597.2	609.7	609.7	606.7	606.7	609.7	609.7	606.7	606.7	609.7	609.7	606.7	606.7	609.7	609.7	606.7	606.7	609.7	609.7	606.7	606.7	609.7	609.7	606.7	606.7	609.7	609.7	606.7	606.7	609.7	609.7	606.7	606.7	609.7	609.7	632.6	632.6	611.5	611.5	627.5	627.5	624.5	624.5	627.5	627.5	624.5	624.5	627.5	627.5	624.5	624.5	627.5	627.5	624.5	624.5	627.5	627.5	624.5	624.5	627.5	627.5	624.5	624.5	627.5	627.5	624.5	624.5	627.5	627.5	624.5	624.5	627.5	627.5	645.3	645.3	642.3	642.3	645.3	645.3	642.3	642.3	645.3	645.3	642.3	642.3	645.3	645.3	642.3	642.3	645.3	645.3	642.3	642.3	645.3	645.3	642.3	642.3	645.3	645.3	642.3	642.3	645.3	645.3	642.3	642.3	645.3	645.3	663.1	663.1	660.1	660.1	663.1	663.1	660.1	660.1	663.1	663.1	660.1	660.1	663.1	663.1	660.1	660.1	663.1	663.1	660.1	660.1	663.1	663.1	660.1	660.1	663.1	663.1	660.1	660.1	663.1	663.1	660.1	660.1	663.1	663.1	680.9	680.9	677.9	677.9	680.9	680.9	677.9	677.9	680.9	680.9	677.9	677.9	680.9	680.9	677.9	677.9	680.9	680.9	677.9	677.9	680.9	680.9	677.9	677.9	680.9	680.9	677.9	677.9	680.9	680.9	677.9	677.9	680.9	680.9	691.5	691.5	695.5	695.5	691.5	691.5	611.5	611.5	632.6	632.6	229.6	229.6	250.7	250.7	170.7]';

for ii = 1 : length(xy)
    xy{ii} = [xy{ii}(:,1)+884.4, xy{ii}(:,2)-431.1];
end

% create joints (start and end coordinates of each beam)
L0 = 91.2;
L1 =                 L0 + p(1);
xy{1}(:,1) = xy{1}(:,1) + p(1);
xy{3}(:,1) = xy{3}(:,1) + p(1);
joints{1} = [-215.6,    198.9;
             -215.6+L1, 198.9];
joints{2} = [-215.6,    198.9+21.1;
             -215.6+L1, 198.9+21.1];
joints{3} = [-215.6,    198.9+21.1*2;
             -215.6+L1, 198.9+21.1*2];
joints{4} = [-215.6,    198.9+21.1*3;
             -215.6+L1, 198.9+21.1*3];
joints{5} = [-215.6,    198.9+21.1*4;
             -215.6+L1, 198.9+21.1*4];

L2 =                 L0 + p(2);
xy{5}(:,1) = xy{5}(:,1) - p(2);
xy{7}(:,1) = xy{7}(:,1) - p(2);
joints{6} = [215.6,    198.9;
             215.6-L2, 198.9];
joints{7} = [215.6,    198.9+21.1;
             215.6-L2, 198.9+21.1];
joints{8} = [215.6,    198.9+21.1*2;
             215.6-L2, 198.9+21.1*2];
joints{9} = [215.6,    198.9+21.1*3;
             215.6-L2, 198.9+21.1*3];
joints{10}= [215.6,    198.9+21.1*4;
             215.6-L2, 198.9+21.1*4];

L3 =                  L0  + p(3);
xy{9}(:,1)  = xy{9}(:,1)  - p(3);
xy{11}(:,1) = xy{11}(:,1) - p(3);
joints{11} = [215.6,   -198.9;
             215.6-L3, -198.9];
joints{12} = [215.6,   -198.9-21.1;
             215.6-L3, -198.9-21.1];
joints{13} = [215.6,   -198.9-21.1*2;
             215.6-L3, -198.9-21.1*2];
joints{14} = [215.6,   -198.9-21.1*3;
             215.6-L3, -198.9-21.1*3];
joints{15}= [215.6,    -198.9-21.1*4;
             215.6-L3, -198.9-21.1*4];

L4 =                  L0  + p(4);
xy{13}(:,1) = xy{13}(:,1) + p(4);
xy{15}(:,1) = xy{15}(:,1) + p(4);
joints{16} = [-215.6,   -198.9;
             -215.6+L4, -198.9];
joints{17} = [-215.6,   -198.9-21.1;
             -215.6+L4, -198.9-21.1];
joints{18} = [-215.6,   -198.9-21.1*2;
             -215.6+L4, -198.9-21.1*2];
joints{19} = [-215.6,   -198.9-21.1*3;
             -215.6+L4, -198.9-21.1*3];
joints{20}= [-215.6,    -198.9-21.1*4;
             -215.6+L4, -198.9-21.1*4];

% add a column to define the mass the joints are attached to or to specify
% if the joint is clamped (-1). If an internal joint (e.g. as in a folded
% beam), put 0.
joints{1}(:,3) = [17 1];
joints{2}(:,3) = [2 1];
joints{3}(:,3) = [2 3];
joints{4}(:,3) = [4 3];
joints{5}(:,3) = [4 -1];
joints{6}(:,3) = [17 5];
joints{7}(:,3) = [6 5];
joints{8}(:,3) = [6 7];
joints{9}(:,3) = [8 7];
joints{10}(:,3) = [8 -1];
joints{11}(:,3) = [17 9];
joints{12}(:,3) = [10 9];
joints{13}(:,3) = [10 11];
joints{14}(:,3) = [12 11];
joints{15}(:,3) = [12 -1];
joints{16}(:,3) = [17 13];
joints{17}(:,3) = [14 13];
joints{18}(:,3) = [14 15];
joints{19}(:,3) = [16 15];
joints{20}(:,3) = [16 -1];

% geometric properties
xg  = zeros(length(xy),1);
yg  = zeros(length(xy),1);
A   = zeros(length(xy),1);
Ixx = zeros(length(xy),1);
Iyy = zeros(length(xy),1);
for ii = 1 : length(xy)
    [xg(ii), yg(ii), A(ii), Ixx(ii), Iyy(ii)] = area_properties(xy{ii}(:,1), xy{ii}(:,2));
end

% specify the constrained DOFs for each mass (1=fixed, 0=free)
mass_constraints = [...
    0 0 0       % 1: connection (top-left beam)
    0 0 0       % 2: connection (top-left beam)
    0 0 0       % 3: connection (top-left beam)
    0 0 0       % 4: connection (top-left beam)
    0 0 0       % 5: connection (top-right beam)
    0 0 0       % 6: connection (top-right beam)
    0 0 0       % 7: connection (top-right beam)
    0 0 0       % 8: connection (top-right beam)
    0 0 0       % 9:  connection (bottom-right beam)
    0 0 0       % 10: connection (bottom-right beam)
    0 0 0       % 11: connection (bottom-right beam)
    0 0 0       % 12: connection (bottom-right beam)
    0 0 0       % 13: connection (bottom-left beam)
    0 0 0       % 14: connection (bottom-left beam)
    0 0 0       % 15: connection (bottom-left beam)
    0 0 0       % 16: connection (bottom-left beam)
    0 0 0];     % 17: central mass

model.joints = joints;
model.xg  = xg;
model.yg  = yg;
model.mass_constraints = mass_constraints;
model.xy  = xy;
model.A   = A;
model.Ixx = Ixx;
model.Iyy = Iyy;

% PLOT GEOMETRY
if plot_geom == 1
    figure
    hold on
    % plot mass shapes
    for ii = 1 : length(xy)
        patch(xy{ii}(:,1),   xy{ii}(:,2),  'k','EdgeColor','none')
    end
    % plot joints and tags
    for ii = 1 : length(joints)
        plot(joints{ii}(:,1), joints{ii}(:,2),'r','LineWidth',2)
        text(mean(joints{ii}(:,1)), mean(joints{ii}(:,2)), num2str(ii),'HorizontalAlignment','center')
        % plot mass-joint (master-slave) connection lines
        for jj = 1 : size(joints{ii},1)
            nm = joints{ii}(jj,3);  % mass number
            if nm==0 % internal joint
                continue
            end
            xs = joints{ii}(jj,1);  % x slave
            ys = joints{ii}(jj,2);  % y slave
            if nm==-1 % clamped joint
                plot(xs, ys, 'ks', 'MarkerFaceColor','k',MarkerSize=7)
                continue
            end
            xm = xg(nm);            % x master
            ym = yg(nm);            % y master
            plot([xs xm],[ys ym],'--','LineWidth',1)
        end
    end
    
    % plot mass tags
    for ii = 1 : length(xy)
        hold on
        plot(xg(ii), yg(ii), 'ko', 'MarkerFaceColor','y',MarkerSize=10)
        text(xg(ii), yg(ii), num2str(ii),'HorizontalAlignment','center')
    end
    axis equal
    % axis off
end

